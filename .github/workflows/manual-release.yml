name: Manual Go release

on:
  workflow_dispatch:
    inputs:
      tag:
        description: リリースタグ名
        required: true
        default: "v2.0.0"
      release_body:
        description: リリースノートの内容
        required: false
        default: "See the assets to download this version and install."
      draft:
        description: 下書きリリースとして作成するか
        required: true
        default: true
        type: boolean

jobs:  
  publish:
    name: Publish for ${{ matrix.goos }}-${{ matrix.goarch }}
    runs-on: ${{ matrix.runner }}
    permissions:
      contents: write
    strategy:
      matrix:
        include:
          - runner: ubuntu-latest
            goos: linux
            goarch: amd64
            ext: ""
          - runner: windows-latest
            goos: windows
            goarch: amd64
            ext: ".exe"
          - runner: macos-latest
            goos: darwin
            goarch: amd64
            ext: ""
          - runner: macos-latest
            goos: darwin
            goarch: arm64
            ext: ""
    steps:
    - uses: actions/checkout@v6
    - uses: actions/setup-go@v6
      with:
        go-version: "1.25"
        cache: false
    - name: Build binary
      shell: bash
      env:
        GOOS: ${{ matrix.goos }}
        GOARCH: ${{ matrix.goarch }}
        CGO_ENABLED: 0
      run: |
        mkdir -p build
        go build -o build/GetNearRankScript-${{ matrix.goos }}-${{ matrix.goarch }}${{ matrix.ext }}
    - name: Release
      uses: softprops/action-gh-release@v2
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        tag_name: ${{ github.event.inputs.tag }}
        files: build/GetNearRankScript-${{ matrix.goos }}-${{ matrix.goarch }}${{ matrix.ext }}
        generate_release_notes: true
        body: ${{ github.event.inputs.release_body }}
        draft: ${{ github.event.inputs.draft }}